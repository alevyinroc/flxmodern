<header class="site-header">
  <div class="container header-inner">
    <div class="brand">
      <a href="{{ .Site.BaseURL }}">{{ .Site.Title }}</a>
    </div>

    <nav class="main-nav">
      <ul>
        {{ $currentPage := . }}
        {{ $site := .Site }}
        {{ range $site.Menus.main }}
          <li class="{{ if or ($currentPage.IsMenuCurrent "main" .) ($currentPage.HasMenuCurrent "main" .) }}active{{ end }}{{ if eq .Name "Categories" }} nav-categories{{ end }}">
            <a href="{{ .URL }}">{{ .Name }}</a>
            {{ if eq .Name "Categories" }}
              <ul class="categories-dropdown">
                {{ $cats := $site.Taxonomies.categories }}
                {{ $sorted := slice }}
                {{ range $name, $pages := $cats }}
                  {{ $sorted = $sorted | append (dict "name" $name "count" (len $pages)) }}
                {{ end }}
                {{ range sort (sort $sorted "name" "asc") "count" "desc" }}
                  <li><a href="{{ "/categories/" | relURL }}{{ .name | urlize }}/">{{ .name }} ({{ .count }})</a></li>
                {{ end }}
              </ul>
            {{ else if .HasChildren }}
              <ul class="submenu">
                {{ range .Children }}
                  <li><a href="{{ .URL }}">{{ .Name }}</a></li>
                {{ end }}
              </ul>
            {{ end }}
          </li>
        {{ end }}
      </ul>
    </nav>

    <div class="header-actions">
      <button id="theme-toggle" aria-label="Toggle color mode">Toggle</button>
    </div>
  </div>
</header>
